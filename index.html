<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blackjack Terminal Game</title>

  <!-- Bootstrap 5.3.3 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Xterm.js CSS CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />

  <style>
    body {
      background-color: #111;
      color: #fff;
    }

    .terminal-wrapper {
      background-color: #000;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
      height: 500px;
      overflow: hidden;
    }

    #terminal {
      height: 100%;
      width: 100%;
    }

    .btn-custom {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="text-center mb-4">üÉè Blackjack Terminal (Human vs AI)</h1>
    
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="terminal-wrapper" id="terminal-container">
          <div id="terminal"></div>
        </div>
        <div class="text-center btn-custom">
          <button class="btn btn-success" id="startBtn">Start Game</button>
          <button class="btn btn-secondary" id="resetStatsBtn">Reset Stats</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Xterm.js JS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.min.js"></script>

  <!-- Game Logic -->
  <script>
    const term = new Terminal();
    term.open(document.getElementById('terminal'));
    term.writeln("Welcome to Blackjack Terminal Game!");
    term.writeln("Type 'start' to begin or 'help' for commands.");

    // LocalStorage boilerplate
    const defaultStats = {
      totalGames: 0,
      wins: 0,
      losses: 0,
      draws: 0,
      blackjacks: 0
    };

    const loadStats = () => {
      const saved = localStorage.getItem("blackjack_stats");
      return saved ? JSON.parse(saved) : { ...defaultStats };
    };

    const saveStats = (stats) => {
      localStorage.setItem("blackjack_stats", JSON.stringify(stats));
    };

    const resetStats = () => {
      localStorage.removeItem("blackjack_stats");
      term.writeln("üìâ Stats have been reset.");
    };

    // Button Events
    $("#startBtn").on("click", () => {
      term.writeln("\nStarting game... (game logic here)");
      // You‚Äôll add game logic in the next phases
    });

    $("#resetStatsBtn").on("click", () => {
      resetStats();
    });

    // Deck & Card Logic
    const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    let deck = [];
    let playerHand = [];
    let dealerHand = [];
    let gameActive = false;

    function createDeck() {
      deck = [];
      for (const suit of suits) {
        for (const value of values) {
          deck.push({ suit, value });
        }
      }
    }

    function shuffleDeck() {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
    }

    function drawCard() {
      return deck.pop();
    }

    // Hand Value Logic
    function calculateHandValue(hand) {
      let value = 0;
      let aces = 0;

      for (const card of hand) {
        if (['J', 'Q', 'K'].includes(card.value)) {
          value += 10;
        } else if (card.value === 'A') {
          value += 11;
          aces++;
        } else {
          value += parseInt(card.value);
        }
      }

      // Adjust for Aces
      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }

      return value;
    }

    function renderHand(hand) {
      return hand.map(c => `[${c.value}${c.suit}]`).join(' ');
    }

    // Game Actions
    function startGame() {
      createDeck();
      shuffleDeck();

      playerHand = [drawCard(), drawCard()];
      dealerHand = [drawCard(), drawCard()];
      gameActive = true;

      term.writeln("\nüéÆ New Game Started!");
      term.writeln("üë§ Your Hand: " + renderHand(playerHand) + ` (Total: ${calculateHandValue(playerHand)})`);
      term.writeln("ü§ñ Dealer Shows: " + `[${dealerHand[0].value}${dealerHand[0].suit}]`);
      term.writeln("Type 'hit' or 'stand'.");
    }

    function checkPlayerStatus() {
      const playerTotal = calculateHandValue(playerHand);

      if (playerTotal === 21) {
        term.writeln("üéâ Blackjack! Let's see what the dealer does...");
        dealerTurn();
      } else if (playerTotal > 21) {
        term.writeln("üí• Bust! You lose.");
        endGame('loss');
      }
    }

    function playerHits() {
      if (!gameActive) return;
      playerHand.push(drawCard());
      const total = calculateHandValue(playerHand);
      term.writeln("üë§ You drew: " + renderHand([playerHand[playerHand.length - 1]]));
      term.writeln("üë§ Your Hand: " + renderHand(playerHand) + ` (Total: ${total})`);
      checkPlayerStatus();
    }

    function playerStands() {
      if (!gameActive) return;
      term.writeln("üß† You stand. Dealer's turn...");
      dealerTurn();
    }

    function dealerTurn() {
      const reveal = renderHand(dealerHand);
      let dealerTotal = calculateHandValue(dealerHand);

      term.writeln("ü§ñ Dealer reveals: " + reveal + ` (Total: ${dealerTotal})`);

      const interval = setInterval(() => {
        if (dealerTotal < 17) {
          const card = drawCard();
          dealerHand.push(card);
          dealerTotal = calculateHandValue(dealerHand);
          term.writeln("ü§ñ Dealer draws: " + renderHand([card]) + ` ‚Üí Total: ${dealerTotal}`);
        } else {
          clearInterval(interval);
          determineWinner();
        }
      }, 1000);
    }

    function determineWinner() {
      const playerTotal = calculateHandValue(playerHand);
      const dealerTotal = calculateHandValue(dealerHand);

      if (dealerTotal > 21 || playerTotal > dealerTotal) {
        term.writeln("‚úÖ You win!");
        endGame('win');
      } else if (dealerTotal > playerTotal) {
        term.writeln("‚ùå Dealer wins!");
        endGame('loss');
      } else {
        term.writeln("ü§ù It's a draw.");
        endGame('draw');
      }
    }

    function endGame(result) {
      gameActive = false;
      const stats = loadStats();
      stats.totalGames++;

      if (result === 'win') stats.wins++;
      if (result === 'loss') stats.losses++;
      if (result === 'draw') stats.draws++;
      if (calculateHandValue(playerHand) === 21 && playerHand.length === 2) stats.blackjacks++;

      saveStats(stats);
      term.writeln("Type 'start' to play again.");
    }

    // Command Parser
    term.onData(e => {
      const cmd = e.trim().toLowerCase();

      switch (cmd) {
        case 'start':
          startGame();
          break;
        case 'hit':
          playerHits();
          break;
        case 'stand':
          playerStands();
          break;
        case 'rules':
          term.writeln("üé≤ Rules: Try to get 21 without going over. Face cards = 10. Aces = 1 or 11. Dealer hits until 17.");
          break;
        case 'restart':
          startGame();
          break;
        default:
          term.writeln(`‚ùì Unknown command: ${cmd}`);
      }
    });
  </script>
</body>
</html>
